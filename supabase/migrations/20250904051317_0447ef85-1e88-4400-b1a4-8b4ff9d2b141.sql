-- Update v_trainers view to include profile_image_position
DROP VIEW IF EXISTS v_trainers;

CREATE VIEW v_trainers AS
SELECT 
  p.id,
  p.created_at,
  p.updated_at,
  p.first_name,
  p.last_name,
  p.bio,
  p.profile_photo_url,
  p.location,
  p.tagline,
  p.is_uk_based,
  p.profile_published,
  p.user_type,
  p.client_survey_completed,
  p.client_survey_completed_at,
  p.primary_goals,
  p.training_location_preference,
  p.preferred_training_frequency,
  p.preferred_time_slots,
  p.preferred_coaching_style,
  p.client_personality_type,
  p.preferred_package_type,
  p.terms_agreed,
  p.consent_marketing,
  p.consent_service,
  p.consent_timestamp,
  p.consent_version,
  p.privacy_policy_version,
  p.marketing_unsubscribed_at,
  p.client_status,
  p.verification_status,
  p.admin_review_notes,
  p.client_journey_stage,
  p.professional_milestones,
  p.profile_image_position,

  -- Trainer-specific fields
  tp.specializations,
  tp.qualifications,
  tp.certifying_body,
  tp.year_certified,
  tp.uploaded_certificates,
  tp.hourly_rate,
  tp.package_options,
  tp.availability_schedule,
  tp.max_clients,
  tp.works_bank_holidays,
  tp.verification_requested_at,
  tp.verification_documents,
  tp.admin_verification_notes,
  tp.is_verified,
  tp.rating,
  tp.total_ratings,
  tp.free_discovery_call,
  tp.offers_discovery_call,
  tp.discovery_call_price,
  tp.calendar_link,
  tp.testimonials,
  tp.training_types,
  tp.delivery_format,
  tp.communication_style,
  tp.video_checkins,
  tp.messaging_support,
  tp.weekly_programming_only,
  tp.ways_of_working_onboarding,
  tp.ways_of_working_first_week,
  tp.ways_of_working_ongoing,
  tp.ways_of_working_tracking,
  tp.ways_of_working_expectations,
  tp.ways_of_working_what_i_bring,
  tp.profile_setup_completed,
  tp.how_started,
  tp.philosophy

FROM profiles p
LEFT JOIN trainer_profiles tp ON p.id = tp.id
WHERE p.user_type = 'trainer';